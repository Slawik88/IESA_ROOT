{% extends "base.html" %}

{% block title %}User search — IESA{% endblock %}

{% block content %}
<div class="container-limited">
  <div class="text-center mb-5">
    <h6 class="section-title d-block mb-4">MEMBER DIRECTORY</h6>
    <h3 class="fw-bold mb-2 text-gray-900">Find & Connect With Members</h3>
    <p class="text-muted">Search our community by name, username, email or ID</p>
  </div>

  <!-- Search form -->
  <form method="get" action="{% url 'users:users_search' %}" class="mb-4">
    <div class="input-group">
      <input type="search" name="q" class="form-control" placeholder="Search by name, username, email or ID..." value="{{ query }}" autofocus>
      <button type="submit" class="btn btn-primary btn-modern">
        <i class="fas fa-search"></i> Search
      </button>
    </div>
  </form>

  {% if query %}
  <h5 class="mb-3 text-muted">Results for "{{ query }}"</h5>
  {% endif %}

  <style>
    @keyframes fadeInUpSmall {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .search-item {
      animation: fadeInUpSmall .32s ease both;
      will-change: transform, opacity;
    }
    mark {
      background-color: #fff3cd;
      color: #333;
      font-weight: 500;
      padding: 1px 3px;
      border-radius: 2px;
    }
  </style>

  <div class="list-group">
    {% for item in results %}
      {% with u=item.user %}
      <a href="{% url 'users:profile_public_username' username=u.username %}" class="list-group-item list-group-item-action d-flex align-items-center search-item animation-delay-{{ forloop.counter0|default:0 }}">
        {% if u.avatar %}
          {% if u.avatar.name and u.avatar.name != 'avatars/default.png' %}
            <span class="avatar avatar-sm me-3"><img src="{{ u.avatar.url }}" alt="{{ u.username }}"></span>
          {% else %}
            <span class="avatar avatar-sm avatar-fallback me-3">{{ u.username|slice:":1"|upper }}</span>
          {% endif %}
        {% else %}
          <span class="avatar avatar-sm avatar-fallback me-3">{{ u.username|slice:":1"|upper }}</span>
        {% endif %}
        <div>
          <div><strong>{{ u.get_full_name|default:u.username }}</strong> <small class="text-muted">@{{ item.username_html|safe }}</small></div>
          <div class="small text-muted">{{ item.email_html|safe }} • <code>{{ item.permanent_id_html|safe }}</code></div>
        </div>
      </a>
      {% endwith %}
    {% empty %}
      <div class="list-group-item">No users found.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
