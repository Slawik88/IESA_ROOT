{% if query %}
    <!-- DEBUG INFO (remove in production) -->
    <!-- Query: '{{ query }}' | Users: {{ results.users|length }} | Posts: {{ results.posts|length }} | Events: {{ results.events|length }} | Partners: {{ results.partners|length }} -->
    
    <div class="search-results">
        <style>
            @keyframes fadeInSmall { from { opacity:0; transform: translateY(6px); } to { opacity:1; transform: translateY(0); } }
            .hx-item { animation: fadeInSmall .28s ease both; }
        </style>
        <!-- Users Results -->
        {% if results.users %}
        <div class="mb-4">
            <h6 class="text-muted fw-bold mb-2">
                <i class="fas fa-users me-2"></i>Users ({{ results.users|length }})
            </h6>
            <div class="list-group">
                {% for user in results.users %}
                    {% if user.username and user.username|length > 0 %}
                        <a href="{% url 'profile_public_username' username=user.username %}" 
                           class="list-group-item list-group-item-action d-flex align-items-center py-2 hx-item" 
                           style="animation-delay: calc({{ forloop.counter0 }} * 28ms);">
                            {% if user.avatar %}
                                <img src="{{ user.avatar.url }}" 
                                     style="width:36px; height:36px; object-fit:cover; border-radius:50%; margin-right:12px;" 
                                     alt="{{ user.username }} avatar" loading="lazy">
                            {% else %}
                                <div class="bg-primary text-white d-flex align-items-center justify-content-center fw-bold"
                                     style="width:36px; height:36px; border-radius:50%; margin-right:12px; font-size:0.9rem;">
                                    {{ user.username|slice:":1"|upper }}
                                </div>
                            {% endif %}
                            <div class="flex-grow-1">
                                <strong>üë§ {{ user.get_full_name|default:user.username }}</strong>
                                <span class="text-muted ms-2">@{{ user.username }}</span>
                                <br>
                                {% if user.email %}
                                    <small class="text-muted"><i class="fas fa-envelope me-1"></i>{{ user.email }}</small>
                                {% endif %}
                            </div>
                        </a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Posts Results -->
        {% if results.posts %}
        <div class="mb-4">
            <h6 class="text-muted fw-bold mb-2">
                <i class="fas fa-file-alt me-2"></i>Posts ({{ results.posts|length }})
            </h6>
            <div class="list-group">
                {% for post in results.posts %}
                {% if post.pk %}
                <a href="{% url 'post_detail' pk=post.pk %}" class="list-group-item list-group-item-action hx-item" style="animation-delay: calc({{ forloop.counter0 }} * 28ms);">
                    <div class="d-flex w-100 justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fw-bold">üìù {{ post.title }}</h6>
                            <p class="mb-1 text-muted small" style="max-height: 2em; overflow: hidden;">
                                {{ post.text|truncatewords:20|striptags }}
                            </p>
                            <small class="text-muted">
                                <i class="fas fa-user me-1"></i>
                                {% if post.author.get_full_name %}
                                    {{ post.author.get_full_name }}
                                {% elif post.author.username %}
                                    {{ post.author.username }}
                                {% else %}
                                    Anonymous
                                {% endif %} ‚Ä¢ 
                                <i class="fas fa-calendar me-1"></i>{{ post.created_at|date:"d M Y" }} ‚Ä¢
                                <i class="fas fa-eye me-1"></i>{{ post.views_count }} views
                            </small>
                        </div>
                        {% if post.preview_image %}
                        <img src="{{ post.preview_image.url }}" style="width:60px; height:60px; object-fit:cover; border-radius:4px; margin-left:12px;" alt="{{ post.title }}">
                        {% endif %}
                    </div>
                </a>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Events Results -->
        {% if results.events %}
        <div class="mb-4">
            <h6 class="text-muted fw-bold mb-2">
                <i class="fas fa-calendar-check me-2"></i>Events ({{ results.events|length }})
            </h6>
            <div class="list-group">
                {% for event in results.events %}
                {% if event.pk %}
                <a href="{% url 'event_detail' pk=event.pk %}" class="list-group-item list-group-item-action hx-item" style="animation-delay: calc({{ forloop.counter0 }} * 28ms);">
                    <div class="d-flex w-100 justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fw-bold">üìÖ {{ event.title }}</h6>
                            <p class="mb-1 text-muted small">{{ event.description|truncatewords:20|striptags }}</p>
                            <small class="text-muted">
                                <i class="fas fa-calendar me-1"></i>{{ event.date|date:"d M Y, H:i" }}
                                {% if event.location %}
                                ‚Ä¢ <i class="fas fa-map-marker-alt me-1"></i>{{ event.location|truncatewords:3 }}
                                {% endif %}
                            </small>
                        </div>
                        {% if event.image %}
                        <img src="{{ event.image.url }}" style="width:60px; height:60px; object-fit:cover; border-radius:4px; margin-left:12px;" alt="{{ event.title }}">
                        {% endif %}
                    </div>
                </a>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Partners Results -->
        {% if results.partners %}
        <div class="mb-4">
            <h6 class="text-muted fw-bold mb-2">
                <i class="fas fa-handshake me-2"></i>Partners ({{ results.partners|length }})
            </h6>
            <div class="list-group">
                {% for partner in results.partners %}
                {% if partner.pk %}
                <a href="#" 
                   hx-get="{% url 'partner_detail' pk=partner.pk %}" 
                   hx-target="#partner-modal-body" 
                   data-bs-toggle="modal" 
                   data-bs-target="#partnerModal"
                   class="list-group-item list-group-item-action hx-item" style="animation-delay: calc({{ forloop.counter0 }} * 28ms);">
                    <div class="d-flex w-100 align-items-center">
                        {% if partner.logo %}
                        <img src="{{ partner.logo.url }}" style="width:40px; height:40px; object-fit:contain; margin-right:12px; border-radius:4px;" alt="{{ partner.name }}">
                        {% else %}
                        <div class="bg-secondary text-white d-flex align-items-center justify-content-center" 
                             style="width:40px; height:40px; border-radius:4px; margin-right:12px; font-weight:bold; font-size:1.2rem;">
                            {{ partner.name|slice:":1"|upper }}
                        </div>
                        {% endif %}
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fw-bold">ü§ù {{ partner.name }}</h6>
                            <p class="mb-0 text-muted small">{{ partner.description|truncatewords:15|striptags }}</p>
                        </div>
                    </div>
                </a>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- No results message -->
        {% if not results.users and not results.posts and not results.events and not results.partners %}
        <div class="text-muted text-center py-4">
            <i class="fas fa-search fa-2x mb-2" style="opacity:0.5;"></i>
            <p class="mb-0">No results found for <strong>"{{ query }}"</strong></p>
            {% if query|length < 2 %}
            <small class="text-muted">Minimum 2 characters required</small>
            {% endif %}
        </div>
        {% endif %}
    </div>
{% else %}
    <div class="text-muted small text-center py-3">
        <i class="fas fa-search me-2"></i>Start typing to search...
    </div>
{% endif %}
