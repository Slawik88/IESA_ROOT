{% load static %}

<a href="{% url 'messaging:conversation_detail' conversation.pk %}" 
   class="list-group-item list-group-item-action {% if conversation.unread_count|default:0 > 0 %}list-group-item-primary{% endif %}">
    <div class="d-flex w-100 justify-content-between">
        <div class="d-flex align-items-center">
            {% if conversation.is_group %}
                <i class="bi bi-people-fill me-2"></i>
                <strong>{{ conversation.group_name }}</strong>
            {% else %}
                <i class="bi bi-person-circle me-2"></i>
                <strong>
                    {% for p in conversation.participants.all %}
                        {% if p != request.user %}{{ p.username }}{% endif %}
                    {% endfor %}
                </strong>
            {% endif %}
        </div>
        <div>
            {% if conversation.unread_count|default:0 > 0 %}
                <span class="badge bg-primary rounded-pill">{{ conversation.unread_count }}</span>
            {% endif %}
            <small class="text-muted">
                {{ conversation.updated_at|timesince }} назад
            </small>
        </div>
    </div>
    
    {% with lm_list=conversation.messages.all|slice:"0:1" %}
        {% for last_message in lm_list %}
            <p class="mb-1 text-muted">
                <small>
                    {% if last_message.sender == request.user %}
                        <i class="bi bi-check2-all"></i> Вы: 
                    {% else %}
                        {{ last_message.sender.username }}: 
                    {% endif %}
                    {{ last_message.text|truncatewords:10 }}
                </small>
            </p>
        {% endfor %}
    {% endwith %}
</a>

