<div>
  <div class="d-flex justify-content-between align-items-center mb-2">
    <strong>Участники</strong>
    <form class="d-flex gap-2" method="post" action="{% url 'messaging:add_participant' conversation.pk %}"
          hx-post="{% url 'messaging:add_participant' conversation.pk %}"
          hx-target="#participants-panel" hx-swap="outerHTML">
      {% csrf_token %}
      <input type="text" name="username" class="form-control form-control-sm" placeholder="username" required>
      <button class="btn btn-sm btn-outline-primary" type="submit" {% if not is_admin %}disabled{% endif %}>Добавить</button>
    </form>
  </div>
  <ul class="list-group">
    {% for p in conversation.participants.all %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>@{{ p.username }}
          {% if conversation.creator == p %}
            <span class="badge bg-secondary ms-2">Создатель</span>
          {% endif %}
          {% if p in conversation.admins.all %}
            <span class="badge bg-info ms-1">Админ</span>
          {% endif %}
        </span>
        <div class="btn-group btn-group-sm">
          {% if is_creator and p != conversation.creator %}
            <form method="post" action="{% url 'messaging:toggle_admin' conversation.pk p.pk %}"
                  hx-post="{% url 'messaging:toggle_admin' conversation.pk p.pk %}"
                  hx-target="#participants-panel" hx-swap="outerHTML">
              {% csrf_token %}
              <button class="btn btn-outline-warning" type="submit">
                {% if p in conversation.admins.all %}Снять админа{% else %}Сделать админом{% endif %}
              </button>
            </form>
          {% endif %}
          {% if is_admin and p != conversation.creator and p != user %}
            <form method="post" action="{% url 'messaging:remove_participant' conversation.pk p.pk %}"
                  hx-post="{% url 'messaging:remove_participant' conversation.pk p.pk %}"
                  hx-confirm="Удалить участника @{{ p.username }}?"
                  hx-target="#participants-panel" hx-swap="outerHTML">
              {% csrf_token %}
              <button class="btn btn-outline-danger" type="submit">Удалить</button>
            </form>
          {% endif %}
        </div>
      </li>
    {% endfor %}
  </ul>
  <div class="mt-2 d-flex justify-content-end">
    <form method="post" action="{% url 'messaging:leave_group' conversation.pk %}">
      {% csrf_token %}
      <button class="btn btn-sm btn-outline-secondary">Покинуть группу</button>
    </form>
  </div>
</div>
